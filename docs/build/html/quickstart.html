

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Quickstart guide &mdash; vegans 0.2.1 documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="copyright" title="Copyright" href="copyright.html" />
    <link rel="next" title="vegans" href="README.html" />
    <link rel="prev" title="Welcome to vegans’s documentation!" href="index.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> vegans
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#"> Quickstart</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#installation">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#loading-data">Loading data</a></li>
<li class="toctree-l2"><a class="reference internal" href="#model-definition">Model definition</a></li>
<li class="toctree-l2"><a class="reference internal" href="#model-training">Model training</a></li>
<li class="toctree-l2"><a class="reference internal" href="#model-evaluation">Model evaluation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#saving-and-loading-models">Saving and loading models</a></li>
<li class="toctree-l2"><a class="reference internal" href="#full-code-snippet">Full code snippet</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="README.html"> Readme</a></li>
<li class="toctree-l1"><a class="reference internal" href="modules.html"> Modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="copyright.html"> Copyright</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">vegans</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Quickstart guide</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/quickstart.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="quickstart-guide">
<h1>Quickstart guide<a class="headerlink" href="#quickstart-guide" title="Permalink to this headline">¶</a></h1>
<p>Here we’re setting up a quick first example to train on the <code class="docutils literal notranslate"><span class="pre">MNIST</span></code> image dataset.</p>
<div class="section" id="installation">
<h2>Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h2>
<p>First we need to install <code class="docutils literal notranslate"><span class="pre">vegans</span></code>. You can do this either with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">vegans</span>
</pre></div>
</div>
<p>or via:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">clone</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">unit8co</span><span class="o">/</span><span class="n">vegans</span><span class="o">.</span><span class="n">git</span>
<span class="n">cd</span> <span class="n">vegans</span>
<span class="n">pip</span> <span class="n">install</span> <span class="o">-</span><span class="n">e</span> <span class="o">.</span>
</pre></div>
</div>
<p>Test if the module can be imported with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">-</span><span class="n">c</span> <span class="s2">&quot;import vegans&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="loading-data">
<h2>Loading data<a class="headerlink" href="#loading-data" title="Permalink to this headline">¶</a></h2>
<p>Here we will quickly load in the data. Dedicated data loaders exist for</p>
<ul class="simple">
<li><p>MNIST</p></li>
<li><p>FashionMNIST</p></li>
<li><p>CelebA</p></li>
<li><p>CIFAR10</p></li>
</ul>
<p>Only the first two are downloaded automatically. The last two need to be downloaded manually but links to the sources of the data are provided
if the data does not yet exist in the <code class="docutils literal notranslate"><span class="pre">root</span></code> directory.</p>
<p>Let’s load the <code class="docutils literal notranslate"><span class="pre">MNIST</span></code> data with the <code class="docutils literal notranslate"><span class="pre">loading</span></code> module:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">root</span> <span class="o">=</span> <span class="s2">&quot;./data/&quot;</span>
<span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">loading</span><span class="o">.</span><span class="n">load_data</span><span class="p">(</span><span class="n">root</span><span class="o">=</span><span class="n">root</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s2">&quot;mnist&quot;</span><span class="p">,</span> <span class="n">download</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>This downloads the data into <code class="docutils literal notranslate"><span class="pre">root</span></code> if it does not yet exist in there. Each image will be of shape <code class="docutils literal notranslate"><span class="pre">(32,</span> <span class="pre">32)</span></code> but vegans requires for the usage
of convolutional neural networks a third dimension for the number of channels. This can easily be done with numpy:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">X_train</span> <span class="o">=</span> <span class="n">X_train</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">32</span><span class="p">))</span>
<span class="n">X_test</span> <span class="o">=</span> <span class="n">X_test</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">32</span><span class="p">))</span>
</pre></div>
</div>
<p>To be able to use a conditional network we also need to one-hot encode the labels. This can also be done with numpy (we recommend the usage of scikit-learn, but want to avoid additional dependencies):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">nb_classes</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">y_train</span><span class="p">))</span>
<span class="n">y_train</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">nb_classes</span><span class="p">)[</span><span class="n">y_train</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)]</span>
<span class="n">y_test</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">nb_classes</span><span class="p">)[</span><span class="n">y_test</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)]</span>
</pre></div>
</div>
<p>Now we can start defining our networks.</p>
</div>
<div class="section" id="model-definition">
<h2>Model definition<a class="headerlink" href="#model-definition" title="Permalink to this headline">¶</a></h2>
<p>What kind of networks you need to define depends on which algorithm you use. Mainly there are three different choices:</p>
<ol class="arabic simple">
<li><dl class="simple">
<dt>GAN1v1 require</dt><dd><ul class="simple">
<li><p>Generator</p></li>
<li><p>Adversary</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>GANGAE require</dt><dd><ul class="simple">
<li><p>Generator</p></li>
<li><p>Adversary</p></li>
<li><p>Encoder</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>VAE require</dt><dd><ul class="simple">
<li><p>Encoder</p></li>
<li><p>Decoder</p></li>
</ul>
</dd>
</dl>
</li>
</ol>
<p>In this guide we will use the <code class="docutils literal notranslate"><span class="pre">VanillaGAN</span></code> which belongs to the first category.</p>
<p>We first need to determine the input and output dimensions for all networks. In the unsupervised / unconditional case it is easy:</p>
<ul class="simple">
<li><dl class="simple">
<dt>Generator</dt><dd><ul>
<li><p>Input: <code class="docutils literal notranslate"><span class="pre">z_dim</span></code> latent dimension (hyper-parameter)</p></li>
<li><p>Output: <code class="docutils literal notranslate"><span class="pre">x_dim</span></code> image dimension</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Discriminator</dt><dd><ul>
<li><p>Input: <code class="docutils literal notranslate"><span class="pre">x_dim</span></code> image dimension</p></li>
<li><p>Output: <code class="docutils literal notranslate"><span class="pre">1</span></code> single output node (might also be different)</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p>For the supervised / conditional algorithms it is a just a little bit more difficult:</p>
<ul class="simple">
<li><dl class="simple">
<dt>c-Generator</dt><dd><ul>
<li><p>Input: <code class="docutils literal notranslate"><span class="pre">z_dim</span> <span class="pre">+</span> <span class="pre">y_dim</span></code> latent dimension and label dimension</p></li>
<li><p>Output: <code class="docutils literal notranslate"><span class="pre">x_dim</span></code> image dimension</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>c-Discriminator</dt><dd><ul>
<li><p>Input: <code class="docutils literal notranslate"><span class="pre">x_dim</span> <span class="pre">+</span> <span class="pre">y_dim</span></code> image dimension and label dimension</p></li>
<li><p>Output: <code class="docutils literal notranslate"><span class="pre">1</span></code> single output node (might also be different)</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p>We can get these sizes with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">x_dim</span> <span class="o">=</span> <span class="n">X_train</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
<span class="n">y_dim</span> <span class="o">=</span> <span class="n">y_train</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
<span class="n">z_dim</span> <span class="o">=</span> <span class="mi">64</span>

<span class="n">gen_in_dim</span> <span class="o">=</span> <span class="n">vegans</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">get_input_dim</span><span class="p">(</span><span class="n">z_dim</span><span class="p">,</span> <span class="n">y_dim</span><span class="p">)</span>
<span class="n">adv_in_dim</span> <span class="o">=</span> <span class="n">vegans</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">get_input_dim</span><span class="p">(</span><span class="n">x_dim</span><span class="p">,</span> <span class="n">y_dim</span><span class="p">)</span>
</pre></div>
</div>
<p>The definition of a generator and adversary architecture is without a doubt the most important (and most difficult) part of
GAN training. We will use the following architecture:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyGenerator</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gen_in_dim</span><span class="p">,</span> <span class="n">x_dim</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">encoding</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">Conv2d</span><span class="p">(</span><span class="n">in_channels</span><span class="o">=</span><span class="n">nr_channels</span><span class="p">,</span> <span class="n">out_channels</span><span class="o">=</span><span class="mi">64</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">stride</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">BatchNorm2d</span><span class="p">(</span><span class="n">num_features</span><span class="o">=</span><span class="mi">64</span><span class="p">),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">LeakyReLU</span><span class="p">(</span><span class="mf">0.2</span><span class="p">),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">Conv2d</span><span class="p">(</span><span class="n">in_channels</span><span class="o">=</span><span class="mi">64</span><span class="p">,</span> <span class="n">out_channels</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">stride</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">BatchNorm2d</span><span class="p">(</span><span class="n">num_features</span><span class="o">=</span><span class="mi">128</span><span class="p">),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">LeakyReLU</span><span class="p">(</span><span class="mf">0.2</span><span class="p">),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">Conv2d</span><span class="p">(</span><span class="n">in_channels</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span> <span class="n">out_channels</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">stride</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">BatchNorm2d</span><span class="p">(</span><span class="n">num_features</span><span class="o">=</span><span class="mi">256</span><span class="p">),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">LeakyReLU</span><span class="p">(</span><span class="mf">0.2</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">decoding</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">ConvTranspose2d</span><span class="p">(</span><span class="n">in_channels</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span> <span class="n">out_channels</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">stride</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">BatchNorm2d</span><span class="p">(</span><span class="n">num_features</span><span class="o">=</span><span class="mi">128</span><span class="p">),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">LeakyReLU</span><span class="p">(</span><span class="mf">0.2</span><span class="p">),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">ConvTranspose2d</span><span class="p">(</span><span class="n">in_channels</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span> <span class="n">out_channels</span><span class="o">=</span><span class="mi">64</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">stride</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">BatchNorm2d</span><span class="p">(</span><span class="n">num_features</span><span class="o">=</span><span class="mi">64</span><span class="p">),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">LeakyReLU</span><span class="p">(</span><span class="mf">0.2</span><span class="p">),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">ConvTranspose2d</span><span class="p">(</span><span class="n">in_channels</span><span class="o">=</span><span class="mi">64</span><span class="p">,</span> <span class="n">out_channels</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">stride</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">BatchNorm2d</span><span class="p">(</span><span class="n">num_features</span><span class="o">=</span><span class="mi">32</span><span class="p">),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">LeakyReLU</span><span class="p">(</span><span class="mf">0.2</span><span class="p">),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">ConvTranspose2d</span><span class="p">(</span><span class="n">in_channels</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span> <span class="n">out_channels</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">stride</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Sigmoid</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">decoding</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">output</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

<span class="n">generator</span> <span class="o">=</span> <span class="n">MyGenerator</span><span class="p">(</span><span class="n">gen_in_dim</span><span class="o">=</span><span class="n">gen_in_dim</span><span class="p">,</span> <span class="n">x_dim</span><span class="o">=</span><span class="n">x_dim</span><span class="p">)</span>
</pre></div>
</div>
<p>Almost the same architecture can be loaded in one line again from the loading module which takes care of choosing the right input dimension:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">generator</span> <span class="o">=</span> <span class="n">loading</span><span class="o">.</span><span class="n">load_generator</span><span class="p">(</span><span class="n">x_dim</span><span class="o">=</span><span class="n">x_dim</span><span class="p">,</span> <span class="n">z_dim</span><span class="o">=</span><span class="n">z_dim</span><span class="p">,</span> <span class="n">y_dim</span><span class="o">=</span><span class="n">y_dim</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s2">&quot;mnist&quot;</span><span class="p">)</span>
<span class="n">discriminator</span> <span class="o">=</span> <span class="n">loading</span><span class="o">.</span><span class="n">load_adversary</span><span class="p">(</span><span class="n">x_dim</span><span class="o">=</span><span class="n">x_dim</span><span class="p">,</span> <span class="n">z_dim</span><span class="o">=</span><span class="n">z_dim</span><span class="p">,</span> <span class="n">y_dim</span><span class="o">=</span><span class="n">y_dim</span><span class="p">,</span> <span class="n">adv_type</span><span class="o">=</span><span class="s2">&quot;Discriminator&quot;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s2">&quot;mnist&quot;</span><span class="p">)</span>

<span class="n">gan_model</span> <span class="o">=</span> <span class="n">ConditionalVanillaGAN</span><span class="p">(</span>
    <span class="n">generator</span><span class="o">=</span><span class="n">generator</span><span class="p">,</span> <span class="n">adversary</span><span class="o">=</span><span class="n">discriminator</span><span class="p">,</span> <span class="n">x_dim</span><span class="o">=</span><span class="n">x_dim</span><span class="p">,</span> <span class="n">z_dim</span><span class="o">=</span><span class="n">z_dim</span><span class="p">,</span> <span class="n">y_dim</span><span class="o">=</span><span class="n">y_dim</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">gan_model</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="model-training">
<h2>Model training<a class="headerlink" href="#model-training" title="Permalink to this headline">¶</a></h2>
<p>The model training can now be done in one line of code:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">gan_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="o">=</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="o">=</span><span class="n">y_train</span><span class="p">)</span>
</pre></div>
</div>
<p>There are quite a few of optional hyper-parameters to choose from in this step. See the full code example below.
The training of the GAN might take a while, depending on the size of your networks, the number of training examples
and your hardware.</p>
</div>
<div class="section" id="model-evaluation">
<h2>Model evaluation<a class="headerlink" href="#model-evaluation" title="Permalink to this headline">¶</a></h2>
<p>We can finally investiagte the results of the GAN with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">samples</span><span class="p">,</span> <span class="n">losses</span> <span class="o">=</span> <span class="n">gan_model</span><span class="o">.</span><span class="n">get_training_results</span><span class="p">(</span><span class="n">by_epoch</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">fixed_labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">gan_model</span><span class="o">.</span><span class="n">get_fixed_labels</span><span class="p">(),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plot_images</span><span class="p">(</span><span class="n">images</span><span class="o">=</span><span class="n">samples</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">fixed_labels</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>You can also generate examples from now on by providing the labels as input:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">test_labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">N</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">test_samples</span> <span class="o">=</span> <span class="n">gan_model</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">test_labels</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plot_images</span><span class="p">(</span><span class="n">images</span><span class="o">=</span><span class="n">test_samples</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">test_labels</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="section" id="saving-and-loading-models">
<h2>Saving and loading models<a class="headerlink" href="#saving-and-loading-models" title="Permalink to this headline">¶</a></h2>
<p>After a network has been trained in can easily be saved with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">gan_model</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s2">&quot;model.torch&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>and later loaded:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">gan_model</span> <span class="o">=</span> <span class="n">VanillaGAN</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;model.torch&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>or:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">gan_model</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;model.torch&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="full-code-snippet">
<h2>Full code snippet<a class="headerlink" href="#full-code-snippet" title="Permalink to this headline">¶</a></h2>
<p>This is the previous code in one single block:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">vegans.utils.loading</span> <span class="k">as</span> <span class="nn">loading</span>
<span class="kn">from</span> <span class="nn">vegans.utils.utils</span> <span class="kn">import</span> <span class="n">plot_images</span>
<span class="kn">from</span> <span class="nn">vegans.GAN</span> <span class="kn">import</span> <span class="n">ConditionalVanillaGAN</span>

<span class="n">root</span> <span class="o">=</span> <span class="s2">&quot;./data/&quot;</span>
<span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">loading</span><span class="o">.</span><span class="n">load_data</span><span class="p">(</span><span class="n">root</span><span class="o">=</span><span class="n">root</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s2">&quot;mnist&quot;</span><span class="p">,</span> <span class="n">download</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">X_train</span> <span class="o">=</span> <span class="n">X_train</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">32</span><span class="p">))</span>
<span class="n">X_test</span> <span class="o">=</span> <span class="n">X_test</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">32</span><span class="p">))</span>
<span class="n">nb_classes</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">y_train</span><span class="p">))</span>
<span class="n">y_train</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">nb_classes</span><span class="p">)[</span><span class="n">y_train</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)]</span>
<span class="n">y_test</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">nb_classes</span><span class="p">)[</span><span class="n">y_test</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)]</span>

<span class="n">x_dim</span> <span class="o">=</span> <span class="n">X_train</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
<span class="n">y_dim</span> <span class="o">=</span> <span class="n">y_train</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
<span class="n">z_dim</span> <span class="o">=</span> <span class="mi">64</span>

<span class="n">generator</span> <span class="o">=</span> <span class="n">loading</span><span class="o">.</span><span class="n">load_generator</span><span class="p">(</span><span class="n">x_dim</span><span class="o">=</span><span class="n">x_dim</span><span class="p">,</span> <span class="n">z_dim</span><span class="o">=</span><span class="n">z_dim</span><span class="p">,</span> <span class="n">y_dim</span><span class="o">=</span><span class="n">y_dim</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s2">&quot;mnist&quot;</span><span class="p">)</span>
<span class="n">discriminator</span> <span class="o">=</span> <span class="n">loading</span><span class="o">.</span><span class="n">load_adversary</span><span class="p">(</span><span class="n">x_dim</span><span class="o">=</span><span class="n">x_dim</span><span class="p">,</span> <span class="n">z_dim</span><span class="o">=</span><span class="n">z_dim</span><span class="p">,</span> <span class="n">y_dim</span><span class="o">=</span><span class="n">y_dim</span><span class="p">,</span> <span class="n">adv_type</span><span class="o">=</span><span class="s2">&quot;Discriminator&quot;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s2">&quot;mnist&quot;</span><span class="p">)</span>

<span class="n">gan_model</span> <span class="o">=</span> <span class="n">ConditionalVanillaGAN</span><span class="p">(</span>
    <span class="n">generator</span><span class="o">=</span><span class="n">generator</span><span class="p">,</span> <span class="n">adversary</span><span class="o">=</span><span class="n">discriminator</span><span class="p">,</span>
    <span class="n">x_dim</span><span class="o">=</span><span class="n">x_dim</span><span class="p">,</span> <span class="n">z_dim</span><span class="o">=</span><span class="n">z_dim</span><span class="p">,</span> <span class="n">y_dim</span><span class="o">=</span><span class="n">y_dim</span><span class="p">,</span>
    <span class="n">optim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">optim_kwargs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>                <span class="c1"># Optional</span>
    <span class="n">feature_layer</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>                           <span class="c1"># Optional</span>
    <span class="n">fixed_noise_size</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span>                          <span class="c1"># Optional</span>
    <span class="n">device</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>                                  <span class="c1"># Optional</span>
    <span class="n">ngpu</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>                                    <span class="c1"># Optional</span>
    <span class="n">folder</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>                                  <span class="c1"># Optional</span>
    <span class="n">secure</span><span class="o">=</span><span class="kc">True</span>                                   <span class="c1"># Optional</span>
<span class="p">)</span>

<span class="n">gan_model</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
<span class="n">gan_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span>
    <span class="n">X_train</span><span class="o">=</span><span class="n">X_train</span><span class="p">,</span>
    <span class="n">y_train</span><span class="o">=</span><span class="n">y_train</span><span class="p">,</span>
    <span class="n">X_test</span><span class="o">=</span><span class="n">X_test</span><span class="p">,</span>           <span class="c1"># Optional</span>
    <span class="n">y_test</span><span class="o">=</span><span class="n">y_test</span><span class="p">,</span>           <span class="c1"># Optional</span>
    <span class="n">batch_size</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span>           <span class="c1"># Optional</span>
    <span class="n">epochs</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>                <span class="c1"># Optional</span>
    <span class="n">steps</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>              <span class="c1"># Optional</span>
    <span class="n">print_every</span><span class="o">=</span><span class="s2">&quot;0.2e&quot;</span><span class="p">,</span>      <span class="c1"># Optional</span>
    <span class="n">save_model_every</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>   <span class="c1"># Optional</span>
    <span class="n">save_images_every</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>  <span class="c1"># Optional</span>
    <span class="n">save_losses_every</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>    <span class="c1"># Optional</span>
    <span class="n">enable_tensorboard</span><span class="o">=</span><span class="kc">False</span> <span class="c1"># Optional</span>
<span class="p">)</span>
<span class="n">samples</span><span class="p">,</span> <span class="n">losses</span> <span class="o">=</span> <span class="n">gan_model</span><span class="o">.</span><span class="n">get_training_results</span><span class="p">(</span><span class="n">by_epoch</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">fixed_labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">gan_model</span><span class="o">.</span><span class="n">get_fixed_labels</span><span class="p">(),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plot_images</span><span class="p">(</span><span class="n">images</span><span class="o">=</span><span class="n">samples</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">fixed_labels</span><span class="p">)</span>

<span class="n">test_labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">N</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">test_samples</span> <span class="o">=</span> <span class="n">gan_model</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">test_labels</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plot_images</span><span class="p">(</span><span class="n">images</span><span class="o">=</span><span class="n">test_samples</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">test_labels</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="README.html" class="btn btn-neutral float-right" title="vegans" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="index.html" class="btn btn-neutral float-left" title="Welcome to vegans’s documentation!" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; <a href="copyright.html">Copyright</a> 2021, unit8.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>